(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],{151:function(e,t,n){e.exports=n(293)},293:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(30),l=n.n(c),o=n(142),i=n(19),u=n(55),s=n(54),f=n(20),m=[f.j,f.i,f.g,f.d,f.h,f.e,f.f,f.a,f.b,f.c],p=r.a.forwardRef((function(e,t){return r.a.createElement(d,e,e.children)})),d=Object(u.a)("div")((function(e){return e.aboveMap?Object(s.a)({zIndex:"1!important",position:"absolute"}):{}}),m),v=function(e){return r.a.createElement(p,Object.assign({display:"flex"},e),e.children)},b=n(59),E=n(300),h=n(297),g=function(e){var t=e.children,n=Object(b.a)(e,["children"]);return r.a.createElement(E.a,{active:!0},r.a.createElement(h.a,n,t))},y=n(86),w=n.n(y),x=n(15),j=n.n(x),O=n(22),R=n(138),k=n.n(R),C=function(e){if(!e.response||!e.response.status)return{message:"no connection to the internet",original:e};return{message:"something went wrong... please try agian",original:e}},z=function(){var e=Object(O.a)(j.a.mark((function e(t){var n,a,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.url,a=t.params,e.prev=1,e.next=4,k.a.get(n,{params:a});case 4:return r=e.sent,e.abrupt("return",{data:r.data,status:r.status});case 8:throw e.prev=8,e.t0=e.catch(1),C(e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}(),S=function(e,t){var n=Object(a.useState)(!1),r=Object(i.a)(n,2),c=r[0],l=r[1],o=Object(a.useState)(!1),u=Object(i.a)(o,2),s=u[0],f=u[1],m=Object(a.useState)(null),p=Object(i.a)(m,2),d=p[0],v=p[1],b=Object(a.useState)(null),E=Object(i.a)(b,2),h=E[0],g=E[1],y=null===t||void 0===t?void 0:t.onComplete,w=null===t||void 0===t?void 0:t.onFailure,x=Object(a.useCallback)(Object(O.a)(j.a.mark((function t(){var n;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return g(null),v(null),l(!0),t.prev=3,t.next=6,e();case 6:n=t.sent,v(n),f(!0),l(!1),y&&y(n),t.next=18;break;case 13:t.prev=13,t.t0=t.catch(3),g(t.t0),l(!1),w&&w(t.t0);case 18:case"end":return t.stop()}}),t,null,[[3,13]])}))),[y,w,e]);return Object(a.useEffect)((function(){t&&t.notImmediate||x()}),[x,t]),{fetching:c,fetched:s,doFetch:x,data:d,error:h}},I=function(e,t){var n=Object(a.useCallback)(Object(O.a)(j.a.mark((function t(){var n,a;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,z({url:"http://localhost:5001/ip/".concat(e)});case 2:return n=t.sent,a=n.data,t.abrupt("return",a);case 5:case"end":return t.stop()}}),t)}))),[e]);return S(n,t)},M={country:{"circle-color":["step",["get","count"],"#c973ff",10,"#ffe11f",20,"#6edbd9",50,"#64ed32",100,"#f7f00f",200,"#ff5f03"],"circle-radius":["step",["get","count"],12,10,25,20,40,50,70,100,75,200,100],"text-size":["step",["get","count"],12,10,14,20,20,50,25,100,29,200,32]},region:{"circle-color":["step",["get","count"],"#c973ff",5,"#ffe11f",10,"#6edbd9",30,"#e1ac55",50,"#f7f00f",100,"#ff5f03"],"circle-radius":["step",["get","count"],18,5,27,10,35,30,51,50,65,100,90],"text-size":["step",["get","count"],12,5,14,10,16,30,18,50,21,100,28]},city:{"circle-color":["step",["get","count"],"#c973ff",5,"#ffe11f",20,"#6edbd9",30,"#e1ac55",40,"#f7f00f",80,"#ff5f03"],"circle-radius":["step",["get","count"],21,5,30,20,27,30,40,40,50,80,70],"text-size":["step",["get","count"],11,5,13,20,15,30,18,40,21,80,28]}},L="cbd66f0a2bbe228fb5712bb3464a6382",V="pk.eyJ1IjoidHJ1ZmZsZTIyIiwiYSI6ImNrYm5yYzF1bzFzcnUydXBmYzA0OHlqcDEifQ.ktwongYmNo0l--QTS3R7MQ";w.a.accessToken=V;var F=r.a.memo((function(e){var t=e.lng,n=e.lat,c=e.zoom,l=e.groupToSwitchRefs,o=e.mostRecentIpRefs,i=e.mostRecentIpInfo,u=e.setMapBoxState,s=e.setClickedCircleFetchParam,f=e.setStats,m=Object(a.useRef)(""),p=I("country"),d=p.data,v=p.fetched,b=p.error,E=I("region"),h=E.data,g=E.fetched,y=E.error,x=I("city"),j=x.data,O=x.fetched,R=x.error,k=v&&g&&O;return Object(a.useEffect)((function(){k&&d&&h&&j&&i&&function(){var e=new w.a.Map({container:m.current,style:"mapbox://styles/truffle22/ckbntzq2q0elx1iqwqk9onysn",center:[t,n],zoom:c}),a=["country","region","city"];e.on("load",(function(){a.forEach((function(t){var n,r;e.addSource("".concat(t,"Source"),{type:"geojson",data:"country"===t?d:"region"===t?h:j,cluster:!0,clusterMaxZoom:"country"===t?1:2}),e.addLayer({id:t,type:"circle",source:"".concat(t,"Source"),paint:{"circle-color":M[t]["circle-color"],"circle-radius":M[t]["circle-radius"],"circle-opacity":.7}}),e.addLayer({id:"".concat(t,"Names"),type:"symbol",source:"".concat(t,"Source"),layout:{"symbol-sort-key":["-",0,["get","count"]],"text-field":["concat",["get",t],["concat","\n",["get","count"]]],"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":M[t]["text-size"]},paint:{"text-color":"#d0c9f0"}});null===(n=l[t])||void 0===n||null===(r=n.current)||void 0===r||r.addEventListener("click",(function(n){p(a),e.setLayoutProperty("".concat(t),"visibility","visible"),e.setLayoutProperty("".concat(t,"Names"),"visibility","visible")})),e.on("click","".concat(t),(function(e){if(e.features&&e.features[0].properties){var t=e.features[0].properties,n=t.country,a=t.region,r=t.city;s({country:n,region:a,city:r})}}))}))})),e.on("style.load",(function(){setTimeout((function(){var e,t;null===(e=l.region)||void 0===e||null===(t=e.current)||void 0===t||t.click()}),2e3)}));for(var r=0;r<o.length;r++){if(!i||!o)throw console.error("unmatching numer of refs and data");!function(){var t,n=parseFloat(i[r].loc.split(",")[0]),a=parseFloat(i[r].loc.split(",")[1]);null===(t=o[r].current)||void 0===t||t.addEventListener("click",(function(){e.flyTo({center:[a,n],zoom:9,essential:!0})}))}()}e.on("click",(function(t){u({lng:t.lngLat.lng,lat:t.lngLat.lat,zoom:parseInt(e.getZoom().toFixed(2))})}));var p=function(t){t.forEach((function(t){e.setLayoutProperty(t,"visibility","none"),e.setLayoutProperty("".concat(t,"Names"),"visibility","none")}))};f({totalVisits:function(e){var t=0;return null===e||void 0===e||e.features.forEach((function(e){var n;t+=null===(n=e.properties)||void 0===n?void 0:n.count})),t}(d),numOfCountries:d.features.length,numOfRegions:h.features.length,numOfCities:j.features.length,lastVisitedTime:i[0].visits[i[0].visits.length-1].time})}()}),[k]),b||y||R?r.a.createElement("h1",{style:{color:"red"}},"could not fetch visitors data from the database...",r.a.createElement("br",null)," please try agian later"," "):r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"mapContainer",style:{position:"absolute",top:0,right:0,left:0,bottom:0,height:"100%",width:"100%"},ref:function(e){m.current=e}}))}),(function(){return!0})),T={lat:51.543,lng:-.1478,zoom:10},B=function(){var e=Object(a.useState)(null),t=Object(i.a)(e,2),n=t[0],r=t[1],c=function(){var e=Object(a.useCallback)(Object(O.a)(j.a.mark((function e(){var t,n,a,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z({url:"https://api.ipify.org/",params:{format:"json"}});case 2:return t=e.sent,n=t.data,e.next=6,z({url:"http://api.ipstack.com/".concat(n.ip),params:{access_key:L}});case 6:return a=e.sent,r=a.data,e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)}))),[]);return S(e)}(),l=c.data,o=c.fetching,u=c.fetched,s=c.error;return Object(a.useEffect)((function(){if(!o&&u&&l){var e=l.latitude,t=l.longitude;r(e&&t?{lat:e,lng:t,zoom:3}:T)}}),[l,u,s,o]),s?[u,T,r]:[u,n,r]},D=function(e,t){var n=Object(a.useCallback)(Object(O.a)(j.a.mark((function t(){var n,a;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,z({url:"http://localhost:5001/ip/",params:e});case 2:return n=t.sent,a=n.data,console.log(a,"fetched!"),t.abrupt("return",a);case 6:case"end":return t.stop()}}),t)}))),[null===e||void 0===e?void 0:e.country,null===e||void 0===e?void 0:e.city,null===e||void 0===e?void 0:e.region,null===e||void 0===e?void 0:e.sort,null===e||void 0===e?void 0:e.size]);return S(n,t)},J=n(302),N=n(299),P=n(38),W=n(301),Y=r.a.memo((function(e){var t=e.totalVisits,n=e.numOfCountries,a=e.numOfRegions,c=e.numOfCities,l=e.lastVisitedTime;return r.a.createElement(r.a.Fragment,null,r.a.createElement(p,{fontSize:window.window.outerWidth<730?"3vw":"1.8vw",lineHeight:"1.1",m:"4px"},"This web-app visualizes"," ",r.a.createElement("a",{href:"http://www.leo-ryuta.work",style:{color:"green"}},"my website's")," ","traffic. ",r.a.createElement(P.a,{name:"react",color:"blue"})," Click the circle for more details!"),r.a.createElement(p,{fontSize:window.window.outerWidth<730?"2vw":"1vw"},r.a.createElement(W.a.Group,{inverted:!0,size:window.window.outerWidth<730?"mini":"small",widths:"three"},r.a.createElement(v,{width:"100%",mt:"20px"},r.a.createElement(W.a,{color:"teal",inverted:!0},r.a.createElement(W.a.Value,null,t," ",r.a.createElement(P.a,{name:"chart line"})),r.a.createElement(W.a.Label,null,"totalVisits")),r.a.createElement(W.a,{color:"purple",inverted:!0},r.a.createElement(W.a.Value,null,r.a.createElement(p,null,["January","February","March","April","May","June","July","August","September","October","November","December"][parseInt(l.split("(")[0].split("/")[1])-1]," ",l.split("(")[0].split("/")[2],",",l.split(")")[1])),r.a.createElement(W.a.Label,null,"last visit time (GMT)",r.a.createElement(P.a,{name:"globe",color:"purple"})))),r.a.createElement(W.a,{color:"red",inverted:!0},r.a.createElement(W.a.Value,null,n),r.a.createElement(W.a.Label,null,"Countries")),r.a.createElement(W.a,{color:"orange",inverted:!0},r.a.createElement(W.a.Value,null,a),r.a.createElement(W.a.Label,null,"Regions")),r.a.createElement(W.a,{color:"pink",inverted:!0},r.a.createElement(W.a.Value,null,c),r.a.createElement(W.a.Label,null,"Cities")))))})),q=n(139);function Z(){var e=Object(q.a)(["\n  color: white;\n  div {\n    color: #c3dfe8;\n    margin-left: 4px;\n  }\n"]);return Z=function(){return e},e}var A=function(e){var t=e.ipData,n=e.mostRecentIpRefs,a=Object(b.a)(e,["ipData","mostRecentIpRefs"]);return r.a.createElement(v,Object.assign({},a,{flexDirection:"column",px:"10px",color:"white",width:"100%",overflowY:"scroll",backgroundColor:"rgba(0, 0, 0, 0.6)"}),t.map((function(e,a){return r.a.createElement(p,{key:a},0!==a&&r.a.createElement(H,null),r.a.createElement(G,{ipinfo:e},n&&r.a.createElement("div",{ref:function(e){n[a].current=e}},r.a.createElement(N.a,{animated:"fade",color:"grey",inverted:!0},r.a.createElement(N.a.Content,{hidden:!0},t[a].region),r.a.createElement(N.a.Content,{visible:!0},"zoom")))))})))},G=function(e){var t=e.ipinfo,n=e.children,a=t._id,c=t.country,l=t.region,o=t.city,i=t.visits,u=t.hostname,s=t.count,f=t.loc,m=t.org,d=t.timezone,b=i[i.length-1].time,E=b.split("/")[1],h=b.split("/")[2].split("(")[0],g=b.split("/")[2].split(")")[1],y="https://www.countryflags.io/".concat(c,"/shiny/64.png");return r.a.createElement(v,{justifyContent:"space-between",py:"2px",marginBottom:"20px"},r.a.createElement(v,{flexDirection:"column",my:"2px"},r.a.createElement(v,{fontSize:"15px",color:"pink",justifyContent:"flex-start",px:"10px"},r.a.createElement("img",{src:y,alt:c}),r.a.createElement(Q,null,r.a.createElement(p,{position:"relative",top:"32px",left:"5px"},c))),r.a.createElement(v,{color:"grey",fontSize:"12px",justifyContent:"flext-between"},r.a.createElement(p,{px:"10px"},r.a.createElement(Q,null,"IPv4: ",r.a.createElement(p,null,a)),r.a.createElement(Q,null,"Region: ",r.a.createElement(p,null,l)),r.a.createElement(Q,null,"City: ",r.a.createElement(p,null,o)," ")),r.a.createElement(p,{px:"10px"},r.a.createElement(Q,null,"Total visits: ",r.a.createElement(p,null,s)," "),r.a.createElement(Q,null,"Location: ",r.a.createElement(p,null,f)),r.a.createElement(Q,null,"Last visit:",r.a.createElement(p,null,E+"/"+h+","+g," (GMT)"))),!n&&r.a.createElement(p,{px:"10px"},d&&r.a.createElement(Q,null,"Time zone: ",r.a.createElement(p,null,d)),m&&r.a.createElement(Q,null,"Organization: ",r.a.createElement(p,null,m)," "),u&&r.a.createElement(Q,null,"Hostname: ",r.a.createElement(p,null,u)," ")))),n&&r.a.createElement(v,{alignItems:"flex-end"},n))},H=function(){return r.a.createElement("hr",{style:{border:"none",height:"2.5px",backgroundColor:"white",width:"110%",top:"27%"}})},Q=Object(u.a)(v)(Z()),U=function(e){var t=e.lat,n=e.lng;return r.a.createElement(v,{p:"10px",justifyContent:"flex-start",color:"white",fontSize:window.window.outerWidth<730?"3vw":"1.7vw"},r.a.createElement(p,{m:"10px"},"lat : ",t),r.a.createElement(p,{m:"10px"},"lng : ",n))},_=function(){var e=Object(a.useState)("MostRecentVisits"),t=Object(i.a)(e,2),n=t[0],c=t[1],l=Object(a.useState)(null),u=Object(i.a)(l,2),s=u[0],f=u[1],m=Object(a.useState)(null),d=Object(i.a)(m,2),b=d[0],E=d[1],h=D({sort:!0,size:5}),y=h.fetched,w=h.data,x=D(Object(o.a)({},s,{sort:!0,size:10})),j=x.fetched,O=x.data,R=B(),k=Object(i.a)(R,3),C=k[0],z=k[1],S=k[2],I=Object(a.useRef)(null),M=Object(a.useRef)(null),L=Object(a.useRef)(null),V={country:I,region:M,city:L},T=[Object(a.useRef)(null),Object(a.useRef)(null),Object(a.useRef)(null),Object(a.useRef)(null),Object(a.useRef)(null)];return Object(a.useEffect)((function(){c(s&&Object.keys(s).length>0?"ClickedCircle":"MostRecentVisits")}),[s]),y&&C&&j?r.a.createElement(p,null,r.a.createElement(p,{aboveMap:!0},z&&r.a.createElement(U,{lat:z.lat,lng:z.lng})),r.a.createElement(p,{aboveMap:!0,top:"6vh",left:window.window.outerWidth<730?"47vw":"56vw",width:window.window.outerWidth<730?"50vw":"40vw"},r.a.createElement(J.a,{inverted:!0},r.a.createElement(p,null,b&&r.a.createElement(Y,b),r.a.createElement(p,{fontWeight:"1000",fontSize:"1.7vw",my:"10px",color:"#cbccc0"},"MostRecentVisits"===n&&s?"Recent Visits":r.a.createElement(r.a.Fragment,null,(null===s||void 0===s?void 0:s.country)&&r.a.createElement(p,null,"Country : ",s.country),(null===s||void 0===s?void 0:s.region)&&r.a.createElement(p,null,"Region : ",s.region),(null===s||void 0===s?void 0:s.city)&&r.a.createElement(p,null,"City : ",s.city))),w&&r.a.createElement(A,{height:"MostRecentVisits"===n?"37vh":"0vh",ipData:w,mostRecentIpRefs:T}),"ClickedCircle"===n&&O&&r.a.createElement(r.a.Fragment,null,r.a.createElement(A,{ipData:O,height:"37vh"}),r.a.createElement(v,{justifyContent:"flex-end",pt:"10px"},r.a.createElement(N.a,{color:"grey",width:"21px",onClick:function(){c("MostRecentVisits")}},"Go back")))))),r.a.createElement(v,{p:"10px",justifyContent:"center",position:"relative",top:"90vh",marginBottom:"3vh",aboveMap:!0},r.a.createElement(X,{switchRef:I},"Country"),r.a.createElement(X,{switchRef:M},"Region"),r.a.createElement(X,{switchRef:L},"City")),z&&r.a.createElement(F,Object.assign({},z,{setMapBoxState:S,groupToSwitchRefs:V,mostRecentIpRefs:T,mostRecentIpInfo:w,setClickedCircleFetchParam:f,setStats:E}))):r.a.createElement(g,{size:"huge",active:!0},"Loading the map...")},X=function(e){var t=e.switchRef,n=e.children;return r.a.createElement(p,{m:"6px"},r.a.createElement("div",{ref:function(e){t.current=e}},r.a.createElement(N.a,{inverted:!0,color:"olive"},r.a.createElement(p,{width:"64px"},n))))},K=function(){return r.a.createElement(_,null)};l.a.render(r.a.createElement(K,null),document.getElementById("root"))}},[[151,1,2]]]);
//# sourceMappingURL=main.d735ccdb.chunk.js.map